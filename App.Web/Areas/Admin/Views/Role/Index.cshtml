@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutPage.cshtml";
}

<div class="row">
    <section class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                Create a new Role
            </div>
            <div class="panel-body">
                @{Html.RenderAction("RoleCreatePartialView", "Role");}
            </div>
        </div>        
    </section>
    <section class="col-xs-12 col-sm-12 col-md-8 col-lg-8"> 
        <div class="panel panel-default">
            <div class="panel-heading">
                List of available Roles
            </div>
            <div id="role-list" class="panel-body">
                @{Html.RenderAction("RoleListPartialView", "Role");}
            </div>
        </div>  
    </section>
</div>
<div id="edit-role-dialog" title="Edit role">    
</div>
<div id="delete-role-dialog" title="Delete role">
    <p>Are you sure you want to delete this role?</p>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        var deleteRoleLink; 
        (function () {         
            $('#edit-role-dialog').dialog({
                autoOpen: false, width: 400, resizable: false, modal: true, //Dialog options
                buttons: {
                    "Save": function () {
                        var role = $('#edit-role').serialize();
                        $.post($('#edit-role').attr('action'), role, function (data) {  //Post to action

                            if (data != null) {
                                $('#role-list').html(data);

                                showMessage('#info-message', 'success', '<strong>Successfully</strong> updated the selected role.');
                            }
                            else {
                                showMessage('#info-message', 'error', '<strong>Update Error!</strong> Could not update the selected role.');
                            }
                            registerClickListeners();
                        });
                        $(this).dialog("close");
                    },
                    "Cancel": function () {
                        $(this).dialog("close");
                    }
                }
            });                       
            $('#delete-role-dialog').dialog({
                autoOpen: false, width: 400, resizable: false, modal: true, //Dialog options
                buttons: {
                    "Delete": function () {
                        $.post(deleteRoleLink[0].href, function (data) {  //Post to action

                            if (data.state == true) {
                                var dataRow = $('#role-list tr[data-id="role-' + data.id + '"]');
                                $(dataRow).effect('highlight', {}, 500, function () {
                                    $(this).fadeOut('fast', function () {
                                        $(this).remove();
                                    });
                                });
                                showMessage('#info-message', 'success', '<strong>Successfully</strong> deleted the selected role: ' + $(dataRow).data('name'));
                            }
                            else {
                                showMessage('#info-message', 'error', '<strong>Delete Error!</strong> Could not delete the selected role: ' + $(dataRow).data('name'));
                            }
                        });
                        $(this).dialog("close");
                    },
                    "Cancel": function () {
                        $(this).dialog("close");
                    }
                }
                
            });

            registerClickListeners();
        })();

        function registerClickListeners() {
            $('.delete-role-link').click(function () {
                deleteRoleLink = $(this);
                $('#delete-role-dialog').dialog('open');
                return false;
            });
            $('.edit-role-link').click(function () {
                $.get($(this)[0].href, function (response) {
                    $('#edit-role-dialog').html(response);
                    $('#edit-role-dialog').dialog('open');
                });
                return false;
            });
        }
        function RoleCreateSuccess(data) {
            registerClickListeners();
            $(':input', '#role-create').not(':button, :submit, :reset, :hidden').val('').removeAttr('checked').removeAttr('selected');
        }
    </script>
}
